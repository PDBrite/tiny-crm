module.exports = {

"[project]/.next-internal/server/app/api/daily-touchpoints/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[project]/src/lib/supabase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "createClientComponentClient": (()=>createClientComponentClient),
    "supabase": (()=>supabase)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
const supabaseUrl = ("TURBOPACK compile-time value", "http://127.0.0.1:54321");
const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey);
function createClientComponentClient() {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey);
}
}}),
"[project]/src/app/api/daily-touchpoints/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    try {
        const url = new URL(request.url);
        const type = url.searchParams.get('type') // 'today', 'overdue', or 'all'
        ;
        const date = url.searchParams.get('date') // Specific date in YYYY-MM-DD format
        ;
        const campaignId = url.searchParams.get('campaignId') // Filter by campaign
        ;
        const company = url.searchParams.get('company') // Filter by company
        ;
        // If specific date is provided, use that; otherwise use today
        let targetDate;
        if (date) {
            targetDate = new Date(date + 'T00:00:00.000Z');
        } else {
            targetDate = new Date();
            targetDate.setHours(0, 0, 0, 0);
        }
        const nextDay = new Date(targetDate);
        nextDay.setDate(nextDay.getDate() + 1);
        let touchpoints = [];
        if (company === 'Avalern') {
            // For Avalern, fetch touchpoints for district contacts
            let query = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('touchpoints').select(`
          *,
          district_contact:district_contacts!inner(
            id,
            first_name,
            last_name,
            email,
            phone,
            title,
            district_lead:district_leads!inner(
              id,
              district_name,
              county,
              company,
              campaign_id,
              campaign:campaigns(id, name, company)
            )
          )
        `).is('completed_at', null) // Only get uncompleted touchpoints
            .eq('district_contact.district_lead.company', 'Avalern');
            // Filter by campaign if specified
            if (campaignId) {
                query = query.eq('district_contact.district_lead.campaign_id', campaignId);
            }
            // If specific date is provided, get touchpoints for that date
            if (date) {
                query = query.gte('scheduled_at', targetDate.toISOString()).lt('scheduled_at', nextDay.toISOString());
            } else {
                // Filter by type for legacy support
                if (type === 'today') {
                    query = query.gte('scheduled_at', targetDate.toISOString()).lt('scheduled_at', nextDay.toISOString());
                } else if (type === 'overdue') {
                    query = query.lt('scheduled_at', targetDate.toISOString());
                } else {
                    // Get both today and overdue
                    query = query.lt('scheduled_at', nextDay.toISOString());
                }
            }
            const { data: districtTouchpoints, error } = await query.order('scheduled_at', {
                ascending: true
            });
            if (error) {
                console.error('Error fetching district touchpoints:', error);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'Failed to fetch touchpoints'
                }, {
                    status: 500
                });
            }
            // Transform district touchpoints to match the expected format
            touchpoints = (districtTouchpoints || []).map((tp)=>({
                    ...tp,
                    lead: {
                        id: tp.district_contact.id,
                        first_name: tp.district_contact.first_name,
                        last_name: tp.district_contact.last_name,
                        email: tp.district_contact.email,
                        phone: tp.district_contact.phone,
                        city: tp.district_contact.district_lead.county,
                        company: tp.district_contact.district_lead.district_name,
                        campaign_id: tp.district_contact.district_lead.campaign_id,
                        campaign: tp.district_contact.district_lead.campaign
                    }
                }));
        } else {
            // For other companies (like CraftyCode), fetch regular lead touchpoints
            let query = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('touchpoints').select(`
          *,
          lead:leads!inner(
            id,
            first_name,
            last_name,
            email,
            phone,
            city,
            company,
            campaign_id,
            campaign:campaigns(name, company)
          )
        `).is('completed_at', null) // Only get uncompleted touchpoints
            ;
            // Filter by company if specified
            if (company) {
                query = query.eq('lead.campaign.company', company);
            }
            // Filter by campaign if specified
            if (campaignId) {
                query = query.eq('lead.campaign_id', campaignId);
            }
            // If specific date is provided, get touchpoints for that date
            if (date) {
                query = query.gte('scheduled_at', targetDate.toISOString()).lt('scheduled_at', nextDay.toISOString());
            } else {
                // Filter by type for legacy support
                if (type === 'today') {
                    query = query.gte('scheduled_at', targetDate.toISOString()).lt('scheduled_at', nextDay.toISOString());
                } else if (type === 'overdue') {
                    query = query.lt('scheduled_at', targetDate.toISOString());
                } else {
                    // Get both today and overdue
                    query = query.lt('scheduled_at', nextDay.toISOString());
                }
            }
            const { data: leadTouchpoints, error } = await query.order('scheduled_at', {
                ascending: true
            });
            if (error) {
                console.error('Error fetching lead touchpoints:', error);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'Failed to fetch touchpoints'
                }, {
                    status: 500
                });
            }
            touchpoints = leadTouchpoints || [];
        }
        // If specific date is provided, return touchpoints for that date
        if (date) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                touchpoints: touchpoints,
                date: date,
                total: touchpoints.length
            });
        }
        // Legacy categorization for today/overdue
        const todayTouchpoints = [];
        const overdueTouchpoints = [];
        for (const touchpoint of touchpoints){
            const scheduledDate = new Date(touchpoint.scheduled_at);
            scheduledDate.setHours(0, 0, 0, 0);
            if (scheduledDate < targetDate) {
                overdueTouchpoints.push(touchpoint);
            } else if (scheduledDate.getTime() === targetDate.getTime()) {
                todayTouchpoints.push(touchpoint);
            }
        }
        // Group by type for easier processing
        const groupedToday = groupTouchpointsByType(todayTouchpoints);
        const groupedOverdue = groupTouchpointsByType(overdueTouchpoints);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            today: {
                total: todayTouchpoints.length,
                by_type: groupedToday,
                touchpoints: todayTouchpoints
            },
            overdue: {
                total: overdueTouchpoints.length,
                by_type: groupedOverdue,
                touchpoints: overdueTouchpoints
            },
            summary: {
                total_due: todayTouchpoints.length + overdueTouchpoints.length,
                emails_due: (groupedToday.email || 0) + (groupedOverdue.email || 0),
                calls_due: (groupedToday.call || 0) + (groupedOverdue.call || 0),
                linkedin_due: (groupedToday.linkedin_message || 0) + (groupedOverdue.linkedin_message || 0)
            }
        });
    } catch (error) {
        console.error('Error fetching daily touchpoints:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const { touchpointId, outcome, outcomeEnum, notes } = await request.json();
        if (!touchpointId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Touchpoint ID is required'
            }, {
                status: 400
            });
        }
        const { data: touchpoint, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('touchpoints').update({
            completed_at: new Date().toISOString(),
            outcome: outcome || null,
            outcome_enum: outcomeEnum || null,
            content: notes ? `${notes}` : undefined
        }).eq('id', touchpointId).select(`
        *,
        lead:leads(id, email, first_name, last_name),
        district_contact:district_contacts(
          id, 
          email, 
          first_name, 
          last_name,
          district_lead:district_leads(id)
        )
      `).single();
        if (error) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to update touchpoint'
            }, {
                status: 500
            });
        }
        // Update appropriate record's last_contacted_at
        if (touchpoint.lead) {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('leads').update({
                last_contacted_at: new Date().toISOString()
            }).eq('id', touchpoint.lead.id);
        } else if (touchpoint.district_contact) {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('district_leads').update({
                last_contacted_at: new Date().toISOString()
            }).eq('id', touchpoint.district_contact.district_lead.id);
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            touchpoint,
            message: 'Touchpoint marked as completed'
        });
    } catch (error) {
        console.error('Error completing touchpoint:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
function groupTouchpointsByType(touchpoints) {
    return touchpoints.reduce((acc, touchpoint)=>{
        const type = touchpoint.type;
        acc[type] = (acc[type] || 0) + 1;
        return acc;
    }, {});
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__a5fd7797._.js.map